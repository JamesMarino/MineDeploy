{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Parameters": {
    "HostedZoneId": {
      "Type": "String",
      "Description": "Hosted Zone Id"
    },
    "HostName": {
      "Type": "String",
      "Description": "Host Name"
    },
    "LoadBalancerURL": {
      "Type": "String",
      "Description": "Load Balancer URL"
    },
    "LoadBalancerHostedZoneId": {
      "Type": "String",
      "Description": "Load Balancer Host Zone ID"
    },
    "AlarmMobileNumber": {
      "Type": "String",
      "Description": "Alarm Notification Mobile Number"
    }
  },
  "Resources": {
    "MineDeployDomain": {
      "Type": "AWS::Route53::RecordSet",
      "Properties": {
        "AliasTarget": {
          "DNSName": {
            "Ref": "LoadBalancerURL"
          },
          "EvaluateTargetHealth": false,
          "HostedZoneId": {
            "Ref": "LoadBalancerHostedZoneId"
          }
        },
        "HostedZoneId": {
          "Ref": "HostedZoneId"
        },
        "Name": {
          "Ref": "HostName"
        },
        "Type": "A"
      }
    },
    "MineDeployHealthCheck": {
      "Type": "AWS::Route53::HealthCheck",
      "Properties": {
        "HealthCheckConfig": {
          "Port": "25565",
          "Type": "TCP",
          "FullyQualifiedDomainName": {
            "Ref": "HostName"
          },
          "RequestInterval": "30",
          "FailureThreshold": "3"
        },
        "HealthCheckTags": [
          {
            "Key": "Name",
            "Value": {
              "Ref": "HostName"
            }
          }
        ]
      }
    },
    "MineDeployHealthCheckAlarm": {
      "Type": "AWS::CloudWatch::Alarm",
      "Properties": {
        "ActionsEnabled": true,
        "AlarmActions": [
          {
            "Ref": "MineDeployNotificationTopic"
          }
        ],
        "AlarmDescription": "MineDeployHealthCheckAlarm",
        "ComparisonOperator": "GreaterThanThreshold",
        "Dimensions": [
          {
            "Name": "HealthCheckId",
            "Value": "MineDeployHealthCheck"
          }
        ],
        "EvaluationPeriods": 3,
        "MetricName": "HealthCheckStatus",
        "Namespace": "AWS/Route53",
        "OKActions": [
          {
            "Ref": "MineDeployNotificationTopic"
          }
        ],
        "Period": 60,
        "Statistic": "Minimum",
        "Threshold": 1.0,
        "TreatMissingData": "notBreaching"
      }
    },
    "MineDeployNotificationTopic": {
      "Type": "AWS::SNS::Topic",
      "Properties": {
        "DisplayName": "MineDeployNotificationTopi1c",
        "Subscription": [
          {
            "Endpoint": {
              "Ref": "AlarmMobileNumber"
            },
            "Protocol": "sms"
          }
        ]
      }
    }
  }
}
